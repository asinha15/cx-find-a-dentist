<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var express = require("express");
var bodyParser = require("body-parser");
var path = require("path");
var hb = require("express-handlebars");
var View = require("./views/view.js");

var Logger = require("./utility/logger.js");

const PORT = 80,
      ABOUT = "This is the Directory Experience EndPoint.",
      SERVICE_HOST = "http://localhost",
      SERVICE_PORT = 8080,
      LOCATION_SEARCH_VIEW_ANCHOR = "location-search";

var logger = new Logger();

// modules
var Collection = require("./collections/collection.js");


/**
 * An express service for hosting the directory experience endpoint
 * @constructor DirectoryEE
 */
var app = express();

// For enabling view caching vs compile and render again
app.enable("view cache");

var options = {
  dotfiles: "ignore",
  extensions: ["htm", "html"],
  index: false
};

app.engine("handlebars", hb({defaultLayout: "main"}));
app.set("view engine", "handlebars");

app.use(express.static(path.join(__dirname, "public"), options ));

app.use(bodyParser.json()); // support json encoded bodies
app.use(bodyParser.urlencoded({ extended: true })); // support encoded bodies

/* UI Requests */

/**
 * @method /location-search.html {GET} Get method for displaying the search page
 * @memberof DirectoryEE
 */
app.get("/location-search.html", function(req, res) {
  res.render("location-search");
});


/**
 * @method /location-search {POST} Post method for submitting the search
 * @memberof DirectoryEE
 */
app.post("/location-search", function(req, res) {
  logger.log("GET /locations");

  var locations = new Collection();
  locations.host = SERVICE_HOST;
  locations.port = SERVICE_PORT;
  locations.path = "/locations";

  var locationsView = new View(
    "locations", // name
    { "locations": [], "title": ""}, // viewModel
    { "locations": "{{collection}}", "title": "Locations:" }); // property map

  locations.fetch({},
    function(code, data) {
      // success
      res.status(code).render(locationsView.getName(), locationsView.enrichData(data));
    },
    function(e) {
      // error
      logger.log("ERROR: Failed to request locations: " + e.message);
      res.status(500).send(e);
    }
  );


});

/* REST API */

app.get("/", function(req, res) {
  logger.log("GET / -> ABOUT");
  res.render("about");
});

app.get("/about", function(req, res) {
  logger.log("GET /ABOUT");
  res.send(ABOUT);
});

// Testing
/*
app.get("/locations", function(req, res) {
  logger.log("GET /locations");

  var locations = new Collection();
  locations.host = SERVICE_HOST;
  locations.port = SERVICE_PORT;
  locations.path = "/locations";

  locations.fetch({},
    function(code, data) {
      // success
      // Note, this is where any enrichment or transformation occur
      res.render("locations", {"locations": data, "title": "Locations:"});
    },
    function(e) {
      logger.log("ERROR: Failed to request locations: " + e.message);
      res.status(500).send(e);
    }
  );
});
*/

app.listen(PORT, function () {
  logger.log("Locations EndPoint listening on port " + PORT);
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="DirectoryEE.html">DirectoryEE</a></li><li><a href="Model.html">Model</a></li><li><a href="View.html">View</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Apr 12 2017 14:55:00 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
